
https://www.developerway.com/posts/react-re-renders-guide

何时 re-render

- state 变化
- 父级  re-render, 所有子组件也会re-render
- context 变化
- hooks 变化
- ~~props 变化~~ 实际是父组件  re-render 引起

阻止 re-render

### 下移状态

- ⛔ 函数组件中创建组件
- 向下移动状态
	- state 封装在更小范围内
	- 减小 re-render 范围, 避免父组件更新
- children 作为 props
	- children 只是 props, 不会受 state 变化而发生 re-render
- 组件 作为 props

### Memo

- 使用 React.memo
	- ⛔ 所有非原始值的道具都必须被记住才能使 React.memo 工作
	- memo 组件的 props 没有变化，则不会 re-render
	- memo 组件的 props 有变化，则用 useMemo
	- memo 组件作为 children 或 props
- 道具上不必要的 useMemo/useCallback
	- 父组件的 props useMemo 后传递给 子组件，不能阻止 re-render
	- 如何解决上面问题：把子组件memo,即：如果一个子组件被包装在 `React.memo` 中，则必须记住所有不是原始值的道具

### 列表

- 如果一个组件使用非原始值作为钩子中的依赖项, 则这个值需要 useMemo
- 列表的子项使用 memo 组件，同时使用key
	- 静态列表可以用 index 做为key
	- 动态列表 不能用 index
### Context

- Provider 的 value 使用 useMemo, 在Provider的父级有state 变化的情况下
- 拆分data Context 和 api Context, 那么只有 用到data 的组件会 re-render
	- react 官网例子
- Context 尽可能拆分的小
- Context 部分值的变化, 导致只使用静态值的组件也 re-render
	- 使用静态值的组件 React.Memo